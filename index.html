<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprovado | Gestão Inteligente</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; color: #334155; overflow-x: hidden; }
        .font-heading { font-family: 'Plus Jakarta Sans', sans-serif; }

        /* Animações */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .anim-entry { animation: fadeInUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; }

        /* Login Rotativo */
        .ideal-para-container { display: flex; align-items: center; justify-content: center; font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.25rem; color: #94a3b8; margin-bottom: 3rem; margin-top: 1rem; }
        @media (min-width: 1024px) { .ideal-para-container { justify-content: flex-start; } }
        .rotating-wrapper { position: relative; height: 1.5em; width: 350px; overflow: hidden; margin-left: 0.5rem; display: inline-block; vertical-align: middle; text-align: left; }
        .rotate-word { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; font-weight: 700; color: #ffffff; opacity: 0; transform: translateY(100%); transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .rotate-word.active { opacity: 1; transform: translateY(0); } .rotate-word.exit { opacity: 0; transform: translateY(-100%); }

        /* Layout */
        .split-screen { display: flex; min-height: 100vh; width: 100%; position: absolute; top: 0; left: 0; z-index: 50; background: white; }
        .left-area { width: 60%; background: radial-gradient(circle at top left, #1e1b4b, #0f172a), linear-gradient(135deg, #172554 0%, #1e3a8a 100%); color: white; display: flex; flex-direction: column; justify-content: center; padding: 5rem 6rem; position: relative; overflow: hidden; }
        .glow-orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.35; }
        .orb-1 { width: 600px; height: 600px; background: #3b82f6; top: -15%; left: -15%; animation: float 10s ease-in-out infinite; }
        .orb-2 { width: 500px; height: 500px; background: #8b5cf6; bottom: -15%; right: -15%; animation: float 12s ease-in-out infinite reverse; }
        .benefit-item { display: flex; align-items: start; gap: 1.25rem; padding: 1.25rem; margin-bottom: 1.25rem; background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.06); border-radius: 16px; backdrop-filter: blur(12px); transition: all 0.3s ease; }
        .benefit-item:hover { background: rgba(255, 255, 255, 0.08); transform: translateX(8px); border-color: rgba(255, 255, 255, 0.2); }
        .icon-circle { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .right-area { width: 40%; background: #F8FAFC; display: flex; align-items: center; justify-content: center; position: relative; }
        .login-card { background: white; width: 100%; max-width: 420px; padding: 3.5rem 2.5rem; border-radius: 24px; box-shadow: 0 25px 60px -15px rgba(15, 23, 42, 0.08); border: 1px solid #f1f5f9; text-align: center; }
        .avatar-circle { width: 72px; height: 72px; margin: 0 auto 1.5rem; background: #eff6ff; color: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.75rem; box-shadow: 0 0 0 6px white, 0 6px 15px rgba(59, 130, 246, 0.15); }
        .input-pro { width: 100%; padding: 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 1rem; color: #1e293b; text-align: center; transition: all 0.2s; margin-bottom: 1.5rem; outline: none; }
        .input-pro:focus { background: white; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        .btn-pro { width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; color: white; background: linear-gradient(135deg, #1e3a8a 0%, #172554 100%); border: none; cursor: pointer; transition: all 0.3s; font-size: 1rem; box-shadow: 0 10px 25px -5px rgba(30, 58, 138, 0.25); }
        .btn-pro:hover { transform: translateY(-2px); box-shadow: 0 15px 30px -5px rgba(30, 58, 138, 0.35); }
        .btn-pro:disabled { opacity: 0.7; cursor: not-allowed; }

        @media (max-width: 1024px) { .split-screen { flex-direction: column; position: relative; height: auto; } .left-area { width: 100%; padding: 3rem 2rem; min-height: auto; text-align: center; } .ideal-para-container { justify-content: center; } .right-area { width: 100%; padding: 2rem; background: white; } .login-card { box-shadow: none; border: none; padding: 0; } .benefit-item { flex-direction: column; align-items: center; text-align: center; } .glow-orb { display: none; } }

        /* LAYOUT GRID (ESTRUTURA V29 - MANTIDA) */
        .app-header { background: #0F172A; color: white; height: 64px; display: flex; align-items: center; padding: 0 32px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); justify-content: space-between; position: sticky; top: 0; z-index: 40; }
        .panel-grid { display: grid; grid-template-columns: 1fr 400px; gap: 24px; max-width: 1600px; margin: 24px auto; padding: 0 24px; height: calc(100vh - 112px); }
        
        /* Dashboard Cards */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .kpi-card { background: white; padding: 1.5rem; border-radius: 12px; border: 1px solid #E2E8F0; box-shadow: 0 2px 4px rgba(0,0,0,0.02); display: flex; flex-col; justify-content: space-between; }
        .status-badge { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; padding: 4px 10px; border-radius: 999px; letter-spacing: 0.05em; }
        .st-draft { background: #f1f5f9; color: #64748b; } .st-sent { background: #dbeafe; color: #1e40af; } .st-negotiating { background: #ffedd5; color: #c2410c; } .st-approved { background: #dcfce7; color: #166534; } .st-canceled { background: #fee2e2; color: #991b1b; }

        /* Editor Section Styles */
        .editor-section { background: white; border: 1px solid #E2E8F0; border-radius: 8px; overflow: hidden; margin-bottom: 24px; }
        .editor-header { background: #F8FAFC; padding: 12px 20px; border-bottom: 1px solid #E2E8F0; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #475569; display: flex; align-items: center; gap: 8px; }
        .editor-body { padding: 20px; }
        .input-group { margin-bottom: 16px; }
        .input-label { display: block; font-size: 0.75rem; font-weight: 600; color: #475569; margin-bottom: 6px; }
        
        /* Timeline */
        .timeline-item { position: relative; padding-left: 2rem; border-left: 2px solid #e2e8f0; padding-bottom: 1.5rem; }
        .timeline-item::before { content: ''; position: absolute; left: -5px; top: 0; width: 8px; height: 8px; border-radius: 50%; background: #94a3b8; }
        .timeline-item:last-child { border-left: transparent; }
        .timeline-desc { font-size: 0.85rem; color: #334155; margin-top: 6px; background: #fff7ed; padding: 12px; border-radius: 8px; border: 1px solid #fed7aa; font-style: italic; }
        
        @media (max-width: 1024px) { .panel-grid { grid-template-columns: 1fr; height: auto; } }

        /* UI Elements & Modal */
        #system-loader { position: fixed; inset: 0; background: #0F172A; z-index: 9999; display: flex; flex-col: column; align-items: center; justify-content: center; color: white; transition: opacity 0.5s; }
        .loader-spin { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(15,23,42,0.6); backdrop-filter: blur(4px); z-index: 60; display: none; align-items: center; justify-content: center; }
        .modal-box { background: white; width: 90%; max-width: 500px; padding: 2rem; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); animation: fadeInUp 0.3s ease-out; }
        #fatal-error { display: none; position: fixed; inset: 0; background: #FFF1F2; z-index: 10000; padding: 40px; align-items: center; justify-content: center; flex-direction: column; text-align: center; }
        @media print { .no-print { display: none !important; } body { background: white; } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="system-loader"><div class="loader-spin"></div><h2 class="text-xl font-bold tracking-widest">APROVADO</h2><p class="text-xs text-slate-400 mt-2">Carregando CRM...</p></div>
    <div id="fatal-error"><i class="fas fa-exclamation-triangle text-4xl text-amber-500 mb-4"></i><h2 class="text-2xl font-bold text-slate-800">Ops! Algo deu errado.</h2><p id="error-msg" class="text-slate-600 mt-2 mb-6 max-w-md">...</p><button onclick="localStorage.clear(); window.location.reload()" class="px-6 py-3 bg-slate-900 text-white rounded font-bold">Recarregar</button></div>

   <script>
/* ================= HELPERS ================= */
function safeVal(id){const e=document.getElementById(id);return e?e.value:''}
function safeText(id,v){const e=document.getElementById(id);if(e)e.innerText=v||''}
function setHTML(id,v){const e=document.getElementById(id);if(e)e.innerHTML=v||''}
function setVal(id,v){const e=document.getElementById(id);if(e)e.value=v||''}

/* ================= SUPABASE ================= */
const SUPABASE_URL = 'https://outasfgohiiyndsjciau.supabase.co'
const SUPABASE_KEY = 'SUA_KEY_AQUI'
const { createClient } = supabase
const db = createClient(SUPABASE_URL, SUPABASE_KEY)

/* ================= STATE ================= */
let state={
  user:null,
  project:null,
  version:null,
  projectsCache:[],
  data:{
    client:{},
    location:{},
    items:[],
    terms:{},
    settings:{},
    history:[]
  }
}

/* ================= NORMALIZER (FIX LINK) ================= */
function normalizeData(dbData){
  const schema={
    client:{name:'',doc:'',email:'',phone:'',address:''},
    location:{address:'',sameAsClient:true},
    items:[],
    terms:{paymentMode:'custom',paymentText:'',deadline:'',validity:'10 dias',obs:''},
    settings:{myPhone:'',serviceType:'Outros'},
    history:[]
  }
  if(!dbData) return structuredClone(schema)

  const items = Array.isArray(dbData.items)
    ? dbData.items
    : Array.isArray(dbData.scope)
      ? dbData.scope
      : []

  return {
    client:{...schema.client,...(dbData.client||{})},
    location:{...schema.location,...(dbData.location||{})},
    items:items.map(i=>({
      name:i.name||'',
      description:i.description||'',
      qty:Number(i.qty)||1,
      price:Number(i.price)||0,
      type:i.type||'original'
    })),
    terms:{...schema.terms,...(dbData.terms||{})},
    settings:{...schema.settings,...(dbData.settings||{})},
    history:Array.isArray(dbData.history)?dbData.history:[]
  }
}

/* ================= INIT ================= */
async function init(){
  const p=new URLSearchParams(location.search)
  const view=p.get('view')||'login'
  const id=p.get('id')

  document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'))

  const {data:{session}}=await db.auth.getSession()
  state.user=session?.user

  if(view==='public'){
    await loadPublicProposal(id)
    return
  }

  if(!state.user){
    document.getElementById('view-login')?.classList.remove('hidden')
    return
  }

  if(view==='dashboard') await loadDashboard()
  if(view==='editor' && id) await loadEditor(id)

  document.getElementById(`view-${view}`)?.classList.remove('hidden')
  document.getElementById('system-loader')?.style.display='none'
}

/* ================= DASHBOARD ================= */
async function loadDashboard(){
  const {data}=await db
    .from('projects')
    .select('*,versions(status,total_value,version_number)')
    .eq('user_id',state.user.id)
    .order('created_at',{ascending:false})

  state.projectsCache=data||[]
  renderDashboardList()
}

/* ================= EDITOR ================= */
async function loadEditor(id){
  const {data:proj}=await db.from('projects').select('*').eq('id',id).single()
  const {data:vers}=await db.from('versions').select('*').eq('project_id',id).order('version_number')

  state.project=proj
  state.version=vers.at(-1)
  state.data=normalizeData(state.version.items||{})

  renderEditor()
}

function renderEditor(){
  const d=state.data
  const locked=['approved','canceled'].includes(state.version.status)

  safeText('ed-title',state.project.name)
  safeText('ed-ver','V'+state.version.version_number)

  let html=''
  let total=0

  d.items.forEach((i,x)=>{
    const t=i.qty*i.price
    total+=t
    html+=`
    <div class="border p-4 rounded mb-2 relative">
      ${!locked?`<button onclick="rmItem(${x})" class="absolute top-2 right-2 text-red-400"><i class="fas fa-trash"></i></button>`:''}
      <input value="${i.name}" onchange="upItem(${x},'name',this.value)" ${locked?'disabled':''} class="w-full font-bold mb-1">
      <textarea onchange="upItem(${x},'description',this.value)" ${locked?'disabled':''} class="w-full text-xs">${i.description}</textarea>
      <div class="grid grid-cols-2 gap-2 mt-2">
        <input type="number" value="${i.qty}" onchange="upItem(${x},'qty',this.value)" ${locked?'disabled':''}>
        <input type="number" value="${i.price}" onchange="upItem(${x},'price',this.value)" ${locked?'disabled':''}>
      </div>
    </div>`
  })

  if(!locked){
    html+=`
    <button onclick="addItem()" class="w-full mt-3 py-3 border-2 border-dashed rounded text-slate-500 hover:border-blue-500">
      <i class="fas fa-plus mr-2"></i> Adicionar item ao escopo
    </button>`
  }

  setHTML('ed-items',html)
  safeText('ed-total',total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'}))
}

function upItem(i,f,v){
  if(!state.data.items[i]) return
  if(f==='qty'||f==='price') state.data.items[i][f]=Number(v)||0
  else state.data.items[i][f]=v
  renderEditor()
}

function addItem(){
  state.data.items.push({name:'',description:'',qty:1,price:0,type:'original'})
  renderEditor()
}

function rmItem(i){
  state.data.items.splice(i,1)
  renderEditor()
}

/* ================= LINK PÚBLICO (FIX) ================= */
async function loadPublicProposal(id){
  const {data:v}=await db
    .from('versions')
    .select('*,projects(name)')
    .eq('id',id)
    .maybeSingle()

  if(!v) throw 'Link inválido'

  state.version=v
  state.data=normalizeData(v.items||{})

  safeText('doc-title',v.projects?.name)
  safeText('doc-total',Number(v.total_value).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}))

  let html=''
  state.data.items.forEach(i=>{
    html+=`<tr>
      <td>${i.name}<br><small>${i.description}</small></td>
      <td>${i.qty}</td>
      <td>${(i.qty*i.price).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}</td>
    </tr>`
  })
  setHTML('doc-items-body',html)

  document.getElementById('public-content')?.classList.remove('hidden')
}

/* ================= START ================= */
window.onload=init
</script>


    <section id="view-success" class="hidden min-h-screen bg-white flex flex-col items-center justify-center p-8 text-center">
        <div class="max-w-md">
            <i id="success-icon" class="fas fa-check-circle text-6xl text-green-500 mb-6 anim-entry"></i>
            <h2 id="success-title" class="text-3xl font-bold text-slate-900 mb-4 anim-entry delay-100">Tudo Certo!</h2>
            <p id="success-desc" class="text-slate-600 text-lg anim-entry delay-200">Sua resposta foi registrada com sucesso.</p>
            <div class="mt-8 text-xs text-slate-400">Pode fechar esta janela.</div>
        </div>
    </section>

    <section id="view-login" class="hidden split-screen">
        <div class="left-area">
            <div class="glow-orb orb-1"></div><div class="glow-orb orb-2"></div>
            <div class="relative z-10 anim-entry">
                <div class="text-blue-300 font-bold tracking-widest text-xs uppercase mb-4">Aprovado.app</div>
                <h1 class="text-5xl font-extrabold leading-tight mb-2 font-heading">Orçamentos que <br><span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-300">Garantem seu</span></h1>
                
                <div class="ideal-para-container">
                    <span>Ideal para:</span>
                    <span id="rotator" class="rotating-wrapper"></span>
                </div>

                <div class="space-y-4">
                    <div class="benefit-item delay-100"><div class="icon-circle bg-blue-600 text-white"><i class="fas fa-shield-alt"></i></div><div><h3 class="font-bold text-lg">Evite prejuízos</h3><p class="text-sm text-indigo-100 opacity-80">Registre mudanças de escopo.</p></div></div>
                    <div class="benefit-item delay-200"><div class="icon-circle bg-emerald-500 text-white"><i class="fas fa-check"></i></div><div><h3 class="font-bold text-lg">Aprovação</h3><p class="text-sm text-indigo-100 opacity-80">Link direto e histórico.</p></div></div>
                    <div class="benefit-item delay-300"><div class="icon-circle bg-purple-500 text-white"><i class="fas fa-file-contract"></i></div><div><h3 class="font-bold text-lg">Sem discussão</h3><p class="text-sm text-indigo-100 opacity-80">Tudo documentado.</p></div></div>
                </div>
            </div>
        </div>
        <div class="right-area">
            <div class="login-card anim-entry delay-300">
                <div class="avatar-circle"><i class="fas fa-user"></i></div>
                <h2 class="text-2xl font-bold text-slate-900 mb-2 font-heading">Acesse sua conta</h2>
                <p class="text-slate-500 mb-8 text-sm">Digite seu e-mail para entrar.</p>
                <input type="email" id="email" placeholder="E-mail" class="input-pro">
                <button onclick="handleLogin()" id="btn-login" class="btn-pro">Enviar link de acesso</button>
            </div>
        </div>
    </section>

    <section id="view-dashboard" class="hidden flex-1">
        <div class="app-header">
            <div class="font-bold text-lg text-white">Aprovado<span class="text-blue-400">APP</span></div>
            <div class="flex gap-3">
                <button onclick="createProject()" class="btn btn-primary bg-white text-slate-900 hover:bg-slate-100 text-xs border-white"><i class="fas fa-plus"></i> Novo Projeto</button>
                <button onclick="db.auth.signOut().then(()=>window.location.reload())" class="text-slate-400 hover:text-white px-2"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>
        <div class="max-w-6xl mx-auto p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                <div class="kpi-card border-emerald-200"><div class="text-emerald-600 font-bold uppercase text-xs">Faturamento Aprovado</div><div class="text-3xl font-bold" id="kpi-total-apr">R$ 0,00</div></div>
                <div class="kpi-card border-amber-200"><div class="text-amber-600 font-bold uppercase text-xs">Pipeline</div><div class="text-3xl font-bold" id="kpi-total-est">R$ 0,00</div></div>
            </div>
            
            <div class="flex gap-4 mb-4">
                <div class="kpi-card bg-amber-50 border-amber-200 flex-1"><div class="kpi-label text-amber-700">Em Negociação</div><div class="kpi-value text-amber-700" id="kpi-count-neg">0</div></div>
                <div class="kpi-card bg-emerald-50 border-emerald-200 flex-1"><div class="kpi-label text-emerald-700">Aprovados</div><div class="kpi-value text-emerald-700" id="kpi-count-apr">0</div></div>
                <div class="kpi-card flex-1"><div class="kpi-label">Cancelados</div><div class="kpi-value text-red-500" id="kpi-count-can">0</div></div>
            </div>

            <div class="flex flex-col md:flex-row gap-4 mb-6 items-center bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex-1 w-full relative"><i class="fas fa-search absolute left-3 top-3 text-slate-400"></i><input id="dash-search" onkeyup="renderDashboardList()" class="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-blue-500" placeholder="Buscar cliente ou projeto..."></div>
                <select id="dash-filter" onchange="renderDashboardList()" class="p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"><option value="all">Todos os Status</option><option value="draft">Rascunhos</option><option value="sent">Enviados</option><option value="negotiating">Em Negociação</option><option value="approved">Aprovados</option><option value="canceled">Cancelados</option></select>
            </div>
            <div id="project-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </section>

    <section id="view-editor" class="hidden flex-1 bg-slate-50 h-screen flex flex-col">
        <div id="editor-loading" class="flex-1 flex items-center justify-center"><div class="spinner border-slate-900"></div></div>
        <div id="editor-content" class="hidden flex flex-col h-full">
            <div class="app-header justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="goTo('dashboard')" class="text-slate-400 hover:text-white"><i class="fas fa-arrow-left"></i></button>
                    <div><h2 id="ed-title" class="font-bold leading-none text-lg text-white">...</h2><span id="ed-ver" class="text-[10px] text-slate-400 uppercase font-bold">V1</span><span id="ed-status-badge" class="ml-2 text-[10px] uppercase font-bold bg-white text-slate-900 px-2 py-1 rounded"></span></div>
                </div>
                <button onclick="share()" class="btn btn-secondary bg-slate-800 border-slate-700 text-white hover:bg-slate-700 text-xs"><i class="fas fa-link"></i> Link Cliente</button>
            </div>
            <div class="panel-grid overflow-hidden">
                <div class="overflow-y-auto pr-2 pb-20 no-scrollbar">
                    <div class="editor-section">
                        <div class="editor-header"><i class="fas fa-user-tie"></i> Dados do Cliente</div>
                        <div class="editor-body">
                            <div class="input-group"><label class="input-label">Nome</label><input id="c-name" class="w-full border p-3 rounded-lg bg-slate-50 text-sm" placeholder="Nome do Cliente / Empresa" onchange="upVal('c-name',this.value)"></div>
                            <div class="grid grid-cols-2 gap-4"><div class="input-group"><label class="input-label">Doc</label><input id="c-doc" class="border p-3 rounded-lg bg-slate-50 text-sm" placeholder="CPF/CNPJ" onchange="upVal('c-doc',this.value)"></div><div class="input-group"><label class="input-label">Tel</label><input id="c-phone" class="border p-3 rounded-lg bg-slate-50 text-sm" placeholder="Telefone" onchange="upVal('c-phone',this.value)"></div></div>
                            <div class="input-group"><label class="input-label">Email</label><input id="c-email" class="w-full border p-3 rounded-lg bg-slate-50 text-sm" placeholder="E-mail" onchange="upVal('c-email',this.value)"></div>
                            <div class="input-group"><label class="input-label">Endereço</label><input id="c-addr" class="w-full border p-3 rounded-lg bg-slate-50 text-sm" placeholder="Endereço Completo" onchange="upVal('c-addr',this.value)"></div>
                            <div class="mt-4 pt-4 border-t"><label class="input-label text-blue-600">Seu WhatsApp</label><input id="in-s-myphone" onchange="upSettings('myPhone', this.value)" class="input-field bg-blue-50 border-blue-200"></div>
                        </div>
                    </div>
                    <div class="editor-section">
                        <div class="editor-header justify-between"><span><i class="fas fa-list-ol"></i> Escopo</span><button id="btn-add-item" onclick="addItem()" class="btn btn-primary text-xs py-1 px-3 bg-slate-800 border-none">+ Item</button></div>
                        <div class="editor-body bg-slate-50 min-h-[300px]"><div id="ed-list"></div></div>
                    </div>
                </div>
                <div class="overflow-y-auto pb-20 no-scrollbar">
                    <div class="editor-section sticky top-0 shadow-lg">
                        <div class="editor-header"><i class="fas fa-coins"></i> Financeiro</div>
                        <div class="editor-body">
                            <div class="bg-slate-900 text-white p-6 rounded-lg text-center mb-6"><div class="text-[10px] font-bold uppercase tracking-widest text-slate-400 mb-1">Total Global</div><div id="ed-total" class="text-3xl font-bold">R$ 0,00</div></div>
                            <div class="input-group"><div class="flex gap-2 mb-2"><select id="pay-mode" class="input-field"><option value="entry_installments">Entrada + Parcelas</option><option value="single">Único</option></select><button onclick="generatePayment()" class="btn btn-secondary px-3"><i class="fas fa-calculator"></i></button></div><div id="payment-display" class="text-xs bg-slate-50 p-3 rounded border border-slate-200 text-slate-600 whitespace-pre-line min-h-[60px]">...</div></div>
                            <div class="grid grid-cols-2 gap-4"><div class="input-group"><label class="input-label">Entrega</label><input id="t-dead" class="border p-2 rounded text-sm" placeholder="Prazo" onchange="upVal('t-dead',this.value)"></div><div class="input-group"><label class="input-label">Validade</label><input id="t-val" class="border p-2 rounded text-sm" placeholder="Validade" onchange="upVal('t-val',this.value)"></div></div>
                            <div class="input-group"><label class="input-label">Obs</label><textarea id="t-obs" class="w-full border p-2 rounded text-sm h-20 mb-4 bg-slate-50" placeholder="Condições de pagamento..." onchange="upVal('t-obs',this.value)"></textarea></div>
                            <div id="ed-actions" class="mt-6"></div>
                        </div>
                    </div>
                    <div class="editor-section"><div class="editor-header"><i class="fas fa-history"></i> Histórico</div><div id="ed-history" class="p-4 space-y-4"></div></div>
                </div>
            </div>
        </div>
    </section>

    <section id="view-public" class="hidden min-h-screen bg-slate-200 p-4 md:py-10 overflow-y-auto print:p-0">
        <div id="public-loading" class="flex justify-center mt-20"><div class="spinner border-slate-900"></div></div>
        <div id="public-content" class="hidden max-w-4xl mx-auto bg-white shadow-2xl min-h-[297mm] relative flex flex-col">
            <div id="stamp-approved" class="hidden absolute top-10 right-10 border-4 border-emerald-600 text-emerald-600 font-bold text-3xl px-6 py-2 uppercase opacity-30 transform -rotate-12 z-20">APROVADO</div>
            <div class="bg-slate-900 text-white p-12 print:bg-white print:text-black print:border-b-2"><div class="flex justify-between items-start"><div><h1 id="doc-title" class="text-3xl font-bold mb-2">Projeto</h1><p class="text-xs uppercase tracking-widest text-slate-400">Proposta Técnica</p></div><div class="text-right"><div id="doc-id" class="font-bold text-lg">#REF</div><div id="doc-date" class="text-sm opacity-70">--/--/--</div></div></div></div>
            <div class="p-12 flex-1">
                <div class="flex gap-12 mb-12 text-sm"><div class="flex-1"><h3 class="font-bold text-xs uppercase text-slate-400 mb-2 border-b pb-1">Contratante</h3><div id="doc-c-name" class="font-bold text-lg text-slate-800"></div><div id="doc-c-doc" class="text-slate-500"></div></div><div class="flex-1"><h3 class="font-bold text-xs uppercase text-slate-400 mb-2 border-b pb-1">Local</h3><div id="doc-c-addr" class="text-slate-600"></div></div></div>
                <div class="mb-12"><h3 class="font-bold text-xs uppercase text-slate-400 mb-4 tracking-wider">Escopo</h3><table class="w-full"><tbody id="doc-items-body"></tbody></table></div>
                <div class="bg-slate-50 border border-slate-100 rounded-lg p-8 mb-12 flex gap-12">
                    <div class="flex-1"><h4 class="font-bold text-xs uppercase text-slate-400 mb-2">Pagamento</h4><div id="doc-payment" class="text-sm font-mono text-slate-700 whitespace-pre-line"></div><div class="mt-4 flex gap-6 text-sm"><div><span class="font-bold text-xs uppercase text-slate-400 block">Entrega</span><span id="doc-deadline"></span></div><div><span class="font-bold text-xs uppercase text-slate-400 block">Validade</span><span id="doc-validity"></span></div></div></div>
                    <div class="text-right"><h4 class="font-bold text-xs uppercase text-slate-400 mb-1">Total</h4><div id="doc-total" class="text-3xl font-bold text-slate-900">R$ 0,00</div></div>
                </div>
                <div id="doc-obs" class="text-xs text-slate-500 italic text-justify"></div>
                <div id="doc-actions" class="no-print mt-12"></div>
            </div>
            <div class="bg-slate-50 p-4 text-center border-t no-print"><button onclick="window.print()" class="text-xs font-bold text-slate-400 uppercase hover:text-slate-600"><i class="fas fa-print"></i> PDF</button></div>
        </div>
    </section>

    <div id="interaction-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 id="modal-title" class="text-xl font-bold mb-2 text-slate-800"></h3>
            <p id="modal-desc" class="text-sm text-slate-500 mb-4"></p>
            <textarea id="modal-input" class="w-full border p-3 rounded-lg mb-4 h-24 text-sm bg-slate-50" placeholder="Digite aqui..."></textarea>
            <div class="flex gap-3"><button onclick="document.getElementById('interaction-modal').style.display='none'" class="flex-1 py-3 border rounded text-slate-500 font-bold hover:bg-slate-50">Cancelar</button><button id="modal-btn" class="flex-1 py-3 rounded text-white font-bold"></button></div>
        </div>
    </div>

</body>
</html>

