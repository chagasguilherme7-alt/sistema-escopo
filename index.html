<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprovado | Acesso</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F8FAFC; overflow-x: hidden; }
        h1, h2, h3, .font-heading { font-family: 'Plus Jakarta Sans', sans-serif; }

        /* Animações */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        
        .anim-entry { animation: fadeIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        /* TEXTO ROTATIVO */
        .rotating-wrapper { display: inline-grid; vertical-align: bottom; height: 1.2em; overflow: hidden; }
        .rotate-word { grid-area: 1/1; opacity: 0; transform: translateY(100%); transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); background: linear-gradient(to right, #60a5fa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .rotate-word.active { opacity: 1; transform: translateY(0); }
        .rotate-word.exit { opacity: 0; transform: translateY(-100%); }

        /* LAYOUT 60/40 */
        .split-screen { display: flex; min-height: 100vh; width: 100%; }

        /* ESQUERDA: Institucional */
        .left-area {
            width: 60%;
            background: radial-gradient(circle at top left, #1e1b4b, #0f172a), linear-gradient(135deg, #1e3a8a 0%, #312e81 100%);
            color: white;
            display: flex; flex-direction: column; justify-content: center;
            padding: 5rem 6rem;
            position: relative; overflow: hidden;
        }
        
        /* Luzes de fundo */
        .glow-orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; }
        .orb-1 { width: 500px; height: 500px; background: #4f46e5; top: -10%; left: -10%; animation: float 10s ease-in-out infinite; }
        .orb-2 { width: 400px; height: 400px; background: #7c3aed; bottom: -10%; right: -10%; animation: float 12s ease-in-out infinite reverse; }

        .brand-logo { font-size: 0.9rem; letter-spacing: 0.1em; text-transform: uppercase; color: #a5b4fc; font-weight: 700; margin-bottom: 2rem; display: flex; align-items: center; gap: 8px; }
        
        /* Cards de Benefícios */
        .benefit-item {
            display: flex; align-items: flex-start; gap: 1.5rem;
            padding: 1.5rem; margin-bottom: 1.5rem;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px; backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .benefit-item:hover { background: rgba(255, 255, 255, 0.08); transform: translateX(10px); border-color: rgba(255, 255, 255, 0.15); }
        
        .icon-circle {
            width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; flex-shrink: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        /* DIREITA: Login */
        .right-area { width: 40%; background: #F8FAFC; display: flex; align-items: center; justify-content: center; position: relative; }
        
        .login-card {
            background: white; width: 100%; max-width: 420px; padding: 3rem 2.5rem;
            border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(15, 23, 42, 0.1);
            border: 1px solid #e2e8f0; text-align: center; position: relative;
        }

        .avatar-circle {
            width: 70px; height: 70px; margin: 0 auto 1.5rem;
            background: #eff6ff; color: #3b82f6; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
            box-shadow: 0 0 0 4px white, 0 4px 10px rgba(59, 130, 246, 0.1);
        }

        .input-pro {
            width: 100%; padding: 16px; background: #f8fafc; border: 1px solid #cbd5e1;
            border-radius: 12px; font-size: 1rem; color: #1e293b; text-align: center;
            transition: all 0.3s; margin-bottom: 1.5rem; outline: none;
        }
        .input-pro:focus { background: white; border-color: #3b82f6; box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }

        .btn-pro {
            width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; color: white;
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            border: none; cursor: pointer; transition: all 0.3s; font-size: 1rem;
            box-shadow: 0 10px 20px -5px rgba(30, 58, 138, 0.3);
        }
        .btn-pro:hover { transform: translateY(-2px); box-shadow: 0 15px 25px -5px rgba(30, 58, 138, 0.4); }

        /* Responsivo */
        @media (max-width: 1024px) {
            .split-screen { flex-direction: column; }
            .left-area { width: 100%; padding: 3rem 2rem; min-height: auto; text-align: center; }
            .right-area { width: 100%; padding: 2rem; background: white; }
            .login-card { box-shadow: none; border: none; padding: 0; }
            .benefit-item { flex-direction: column; align-items: center; text-align: center; }
            .glow-orb { display: none; }
        }

        /* LOADING & INTERNOS */
        #loader { position: fixed; inset: 0; background: #0f172a; z-index: 9999; display: flex; flex-col: align-items: center; justify-content: center; transition: opacity 0.5s; }
        .hidden { display: none !important; }
        .app-header { background: #fff; border-bottom: 1px solid #e5e7eb; height: 72px; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; position: sticky; top: 0; z-index: 50; }
        .project-card { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.2s; }
        .project-card:hover { border-color: #3b82f6; transform: translateY(-3px); box-shadow: 0 10px 20px -5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

    <div id="loader">
        <i class="fas fa-circle-notch fa-spin text-blue-500 text-3xl mb-4"></i>
        <div class="text-white font-bold tracking-widest text-xs uppercase opacity-70">Carregando Sistema</div>
    </div>

    <script>
        // =================================================================
        // ⚠️ SUAS CHAVES DO SUPABASE
        // =================================================================
        const SUPABASE_URL = 'https://outasfgohiiyndsjciau.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im91dGFzZmdvaGlpeW5kc2pjaWF1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4MTk4ODIsImV4cCI6MjA4NTM5NTg4Mn0.4yvGfYbQYf806FJcs34yPGkuU_kVTYHW8mBtbU3JD80';
        // =================================================================

        const { createClient } = supabase;
        const db = createClient(SUPABASE_URL, SUPABASE_KEY);
        let state = { user: null, project: null, version: null, data: { items: [], client: {}, terms: {}, location: {} } };

        function normalizeData(d) {
            const schema = { client: { name: '', doc: '', email: '', phone: '', address: '' }, location: { address: '', sameAsClient: true }, items: [], terms: { paymentMode: 'custom', paymentText: '', deadline: '', validity: '10 dias', obs: '' }, settings: { myPhone: '' } };
            if (!d) return schema;
            const items = (Array.isArray(d) ? d : (d.items || d.scope || [])).map(i => ({ name: i.name||'', description: i.description||'', qty: parseFloat(i.qty)||1, price: parseFloat(i.price)||0, type: i.type||'original' }));
            return { client: {...schema.client, ...(d.client||{})}, location: {...schema.location, ...(d.location||{})}, items, terms: {...schema.terms, ...(d.terms||{})}, settings: {...schema.settings, ...(d.settings||{})} };
        }

        async function init() {
            const p = new URLSearchParams(window.location.search);
            const view = p.get('view') || 'login';
            const id = p.get('id');
            document.querySelectorAll('section').forEach(el => el.classList.add('hidden'));
            
            // Verifica sessão
            const { data: { session } } = await db.auth.getSession();
            state.user = session?.user;

            if (view === 'public') {
                if(id) await loadPublic(id);
                document.getElementById('view-public').classList.remove('hidden');
            } else if (!state.user) {
                window.history.replaceState(null, '', '?view=login');
                document.getElementById('view-login').classList.remove('hidden');
                initRotator();
            } else {
                document.getElementById('view-app').classList.remove('hidden');
                if(view === 'dashboard' || !view) loadDashboard();
                if(view === 'editor' && id) loadEditor(id);
            }
            setTimeout(() => { document.getElementById('loader').style.opacity = '0'; setTimeout(()=>document.getElementById('loader').style.display='none', 500); }, 500);
        }

        function initRotator() {
            const words = ["Eletricistas", "Instaladores", "Técnicos", "Prestadores"];
            let idx = 0;
            const el = document.getElementById('rotator');
            if(!el) return;
            el.innerHTML = `<span class="rotate-word active">${words[0]}</span>`;
            
            setInterval(() => {
                const current = el.querySelector('.active');
                if(current) { current.classList.remove('active'); current.classList.add('exit'); }
                
                idx = (idx + 1) % words.length;
                const next = document.createElement('span');
                next.className = 'rotate-word';
                next.innerText = words[idx];
                el.appendChild(next);
                
                // Force reflow
                void next.offsetWidth;
                next.classList.add('active');
                
                setTimeout(() => { if(current) current.remove(); }, 600);
            }, 3000);
        }

        function goTo(v, id) { window.history.pushState(null, '', id ? `?view=${v}&id=${id}` : `?view=${v}`); init(); }
        async function login() {
            const email = document.getElementById('email').value;
            const btn = document.getElementById('btn-login');
            if(!email) return alert("Digite o e-mail");
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            const { error } = await db.auth.signInWithOtp({ email, options: { emailRedirectTo: window.location.href }});
            if(error) { alert(error.message); btn.innerText = 'Tentar Novamente'; }
            else { btn.innerText = 'Link Enviado! Verifique seu E-mail'; alert('Link enviado!'); }
        }

        async function loadDashboard() {
            document.getElementById('screen-dashboard').classList.remove('hidden');
            document.getElementById('screen-editor').classList.add('hidden');
            const list = document.getElementById('proj-list');
            list.innerHTML = '<div class="text-gray-400">Buscando projetos...</div>';
            
            // Busca Projetos com Debug
            const { data, error } = await db.from('projects').select('*, versions(status, total_value, version_number)').eq('user_id', state.user.id).order('created_at', {ascending:false});
            
            if(error) {
                list.innerHTML = `<div class="col-span-3 text-red-500">Erro ao buscar: ${error.message}</div>`;
                return;
            }

            let ap=0, pe=0; list.innerHTML = '';
            
            if(!data || data.length === 0) {
                list.innerHTML = `
                    <div class="col-span-3 text-center py-20 border-2 border-dashed border-gray-200 rounded text-gray-400">
                        <i class="fas fa-folder-open text-4xl mb-2 opacity-30"></i><br>
                        Nenhum projeto encontrado.<br>
                        <span class="text-xs">Logado como: ${state.user.email}</span>
                    </div>`;
            } else {
                data.forEach(p => {
                    const v = p.versions?.[0] || {total_value:0, status:'draft', version_number:1};
                    const val = parseFloat(v.total_value)||0; if(v.status==='approved') ap+=val; else pe+=val;
                    list.innerHTML += `<div onclick="goTo('editor','${p.id}')" class="project-card"><h3 class="font-bold text-lg">${p.name}</h3><p class="text-xs text-gray-500 uppercase mt-1">V${v.version_number} • ${v.status==='approved'?'APROVADO':'ABERTO'}</p><div class="mt-4 text-xl font-bold text-slate-800">R$ ${val.toLocaleString('pt-BR',{minimumFractionDigits:2})}</div></div>`;
                });
            }
            document.getElementById('kpi-ap').innerText = ap.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
            document.getElementById('kpi-pe').innerText = pe.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
        }

        async function create() {
            const name = prompt("Nome do Projeto:"); if(!name) return;
            const { data: p } = await db.from('projects').insert({ name, user_id: state.user.id, client_name: 'Novo' }).select().single();
            const d = normalizeData(null); d.settings.myPhone = localStorage.getItem('escopo_phone')||'';
            await db.from('versions').insert({ project_id: p.id, version_number: 1, items: d, total_value: 0, status: 'draft' });
            goTo('editor', p.id);
        }

        async function loadEditor(id) {
            document.getElementById('screen-dashboard').classList.add('hidden');
            document.getElementById('screen-editor').classList.remove('hidden');
            const { data: proj } = await db.from('projects').select('*').eq('id', id).single();
            state.project = proj;
            const { data: vers } = await db.from('versions').select('*').eq('project_id', id).order('version_number', {ascending:true});
            state.version = vers[vers.length-1];
            state.data = normalizeData(state.version.items);
            if(state.version.notes && !state.data.terms.obs) state.data.terms.obs = state.version.notes;
            renderEditor();
        }

        function renderEditor() {
            const d = state.data; const isLock = state.version.status === 'approved';
            document.getElementById('ed-title').innerText = state.project.name;
            document.getElementById('ed-ver').innerText = `V${state.version.version_number}`;
            const set = (id,v) => document.getElementById(id).value = v||'';
            set('c-name', d.client.name); set('c-doc', d.client.doc); set('c-email', d.client.email); set('c-phone', d.client.phone); set('c-addr', d.client.address); set('s-phone', d.settings.myPhone);
            set('t-dead', d.terms.deadline); set('t-val', d.terms.validity); set('t-obs', d.terms.obs);
            const list = document.getElementById('ed-items'); list.innerHTML = ''; let total = 0;
            d.items.forEach((i,x) => {
                const t = (i.qty||0)*(i.price||0); total+=t;
                const lock = isLock || (i.type==='original' && state.version.version_number>1);
                list.innerHTML += `<div class="bg-white border p-4 rounded mb-2 shadow-sm"><div class="flex justify-between mb-2"><span class="text-xs font-bold uppercase bg-slate-100 px-2 py-1 rounded text-slate-500">${i.type}</span>${!lock?`<button onclick="rmItem(${x})" class="text-red-500 text-xs font-bold hover:text-red-700">REMOVER</button>`:''}</div><div class="flex gap-2 mb-2"><input class="w-full border p-2 rounded bg-slate-50" value="${i.name}" onchange="upItem(${x},'name',this.value)" placeholder="Título" ${lock?'disabled':''}><input type="number" class="w-24 border p-2 rounded text-center bg-slate-50" value="${i.qty}" onchange="upItem(${x},'qty',this.value)" ${lock?'disabled':''}><input type="number" class="w-32 border p-2 rounded text-right bg-slate-50" value="${i.price}" onchange="upItem(${x},'price',this.value)" ${lock?'disabled':''}></div><textarea class="w-full border p-2 rounded text-sm bg-slate-50" onchange="upItem(${x},'description',this.value)" placeholder="Descrição..." ${lock?'disabled':''}>${i.description||''}</textarea><div class="text-right font-bold mt-1 text-slate-800">R$ ${t.toLocaleString('pt-BR',{minimumFractionDigits:2})}</div></div>`;
            });
            document.getElementById('ed-total').innerText = total.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
            document.getElementById('ed-actions').innerHTML = isLock ? `<button onclick="addVersion()" class="w-full bg-amber-600 text-white p-3 rounded font-bold hover:bg-amber-700">Criar Aditivo</button>` : `<button onclick="save()" class="w-full bg-slate-900 text-white p-3 rounded font-bold hover:bg-slate-800">Salvar Proposta</button>`;
        }

        function upItem(i,f,v) { const it=state.data.items[i]; if(f==='qty'||f==='price') it[f]=parseFloat(v)||0; else it[f]=v; renderEditor(); }
        function addItem() { state.data.items.push({name:'',description:'',qty:1,price:0,type:state.version.version_number>1?'addon':'original'}); renderEditor(); }
        function rmItem(i) { state.data.items.splice(i,1); renderEditor(); }
        function upVal(k,v) { if(k.startsWith('c-')) state.data.client[k.substring(2)] = v; else if(k.startsWith('t-')) state.data.terms[k.substring(2)] = v; else if(k==='s-phone') { state.data.settings.myPhone=v; localStorage.setItem('escopo_phone',v); } }
        async function save() { const t = state.data.items.reduce((a,b)=>a+(b.qty*b.price),0); if(state.data.client.name) await db.from('projects').update({client_name:state.data.client.name}).eq('id',state.project.id); await db.from('versions').update({items:state.data, total_value:t, notes:state.data.terms.obs}).eq('id',state.version.id); alert("Salvo!"); }
        async function addVersion() { if(!confirm("Criar aditivo?")) return; const t = state.data.items.reduce((a,b)=>a+(b.qty*b.price),0); await db.from('versions').insert({project_id:state.project.id, version_number:state.version.version_number+1, items:state.data, total_value:t, status:'draft'}); loadEditor(state.project.id); }
        async function share() { if(state.version.status!=='approved') await save(); navigator.clipboard.writeText(`${window.location.origin}${window.location.pathname}?view=public&id=${state.version.id}`); alert("Link copiado!"); }
        async function loadPublic(id) { const { data: v } = await db.from('versions').select('*, projects(name)').eq('id', id).single(); state.version = v; const d = normalizeData(v.items); const txt = (id,v) => document.getElementById(id).innerText = v||'-'; txt('pub-title', v.projects.name); txt('pub-id', `#${v.project_id.substr(0,4).toUpperCase()}-${v.version_number}`); txt('pub-date', new Date(v.created_at).toLocaleDateString()); txt('pub-client', d.client.name); txt('pub-doc', d.client.doc); txt('pub-total', parseFloat(v.total_value).toLocaleString('pt-BR',{style:'currency',currency:'BRL'})); document.getElementById('pub-items').innerHTML = d.items.map(i => `<div class="flex justify-between py-2 border-b"><div><b>${i.name}</b><br><small>${i.description}</small></div><div class="text-right"><small>${i.qty}x</small><br><b>R$ ${(i.qty*i.price).toLocaleString('pt-BR')}</b></div></div>`).join(''); if(v.status==='approved') document.getElementById('pub-actions').innerHTML = '<div class="bg-green-100 text-green-800 p-4 text-center font-bold rounded">APROVADO</div>'; }
        async function approve() { if(!confirm("Confirmar aprovação?")) return; await db.from('versions').update({status:'approved', approved_at:new Date()}).eq('id',state.version.id); window.location.reload(); }

        window.onload = init;
    </script>

    <section id="view-login" class="hidden split-screen">
        
        <div class="left-area">
            <div class="glow-orb orb-1"></div>
            <div class="glow-orb orb-2"></div>

            <div class="relative z-10 anim-entry">
                <div class="brand-logo"><i class="fas fa-check-circle text-blue-400"></i> APROVADO.APP</div>
                
                <h1 class="text-5xl font-extrabold leading-tight mb-2 font-heading">
                    Orçamentos que <br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-300">Garantem seu</span>
                </h1>
                <h2 class="text-5xl font-extrabold leading-tight mb-8 font-heading flex gap-3">
                    <span id="rotator" class="rotating-wrapper text-white"></span>
                </h2>
                
                <p class="text-indigo-200 text-lg mb-10 max-w-lg">
                    Ideal para profissionais de serviços técnicos. <br>Evite prejuízos e profissionalize sua gestão.
                </p>

                <div class="space-y-4">
                    <div class="benefit-item delay-100">
                        <div class="icon-circle bg-blue-600 text-white"><i class="fas fa-shield-alt"></i></div>
                        <div><h3 class="font-bold text-lg">Evite prejuízos</h3><p class="text-sm text-indigo-100 opacity-80">Registre mudanças de escopo e se proteja.</p></div>
                    </div>
                    <div class="benefit-item delay-200">
                        <div class="icon-circle bg-emerald-500 text-white"><i class="fas fa-check"></i></div>
                        <div><h3 class="font-bold text-lg">Aprovação do cliente</h3><p class="text-sm text-indigo-100 opacity-80">Orçamentos aprovados por link, com histórico.</p></div>
                    </div>
                    <div class="benefit-item delay-300">
                        <div class="icon-circle bg-purple-500 text-white"><i class="fas fa-file-contract"></i></div>
                        <div><h3 class="font-bold text-lg">Menos discussão</h3><p class="text-sm text-indigo-100 opacity-80">Tudo documentado, sem retrabalho.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-area">
            <div class="login-card anim-entry delay-300">
                <div class="absolute top-4 right-4 text-[10px] font-bold text-slate-300">V16</div>

                <div class="avatar-circle">
                    <i class="fas fa-user"></i>
                </div>
                
                <h2 class="text-2xl font-bold text-slate-900 mb-2 font-heading">Acesse sua conta</h2>
                <p class="text-slate-500 mb-8 text-sm">Digite seu e-mail para entrar.</p>

                <input type="email" id="email" placeholder="E-mail" class="input-pro">
                
                <button onclick="login()" id="btn-login" class="btn-pro">
                    Enviar link de acesso
                </button>
            </div>
        </div>
    </section>

    <section id="view-app" class="hidden min-h-screen bg-gray-50 flex flex-col">
        <header class="app-header bg-white shadow-sm">
            <div class="font-bold text-xl flex items-center gap-2 font-heading"><i class="fas fa-check-circle text-blue-600"></i> Aprovado</div>
            <div class="flex gap-2">
                <button onclick="window.location.reload()" class="text-gray-400 hover:text-blue-500 px-2" title="Recarregar Dados"><i class="fas fa-sync"></i></button>
                <button onclick="create()" class="text-sm bg-slate-900 text-white px-4 py-2 rounded-lg font-bold hover:bg-slate-800 transition-all">+ Novo</button>
                <button onclick="db.auth.signOut().then(()=>window.location.reload())" class="text-gray-400 hover:text-red-500 px-2"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <div id="screen-dashboard" class="w-full max-w-6xl mx-auto p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                <div class="bg-white p-6 rounded-xl border border-green-100 shadow-sm"><div class="text-xs font-bold text-green-600 uppercase mb-1">Aprovado</div><div class="text-3xl font-bold font-heading text-slate-800" id="kpi-ap">R$ 0,00</div></div>
                <div class="bg-white p-6 rounded-xl border border-amber-100 shadow-sm"><div class="text-xs font-bold text-amber-600 uppercase mb-1">Em Aberto</div><div class="text-3xl font-bold font-heading text-slate-800" id="kpi-pe">R$ 0,00</div></div>
            </div>
            <h3 class="font-bold text-slate-400 text-xs uppercase tracking-wider mb-4">Seus Projetos</h3>
            <div id="proj-list" class="grid grid-cols-1 md:grid-cols-3 gap-4"></div>
        </div>

        <div id="screen-editor" class="hidden grid grid-cols-1 lg:grid-cols-[1fr_380px] gap-6 w-full max-w-7xl mx-auto p-8">
            <div class="overflow-y-auto">
                <div class="flex justify-between items-end mb-6">
                    <div><h2 id="ed-title" class="text-2xl font-bold font-heading text-slate-900">...</h2><span id="ed-ver" class="text-xs bg-slate-200 px-2 py-1 rounded font-bold text-slate-600">V1</span></div>
                    <button onclick="share()" class="text-sm border border-blue-200 text-blue-600 px-4 py-2 rounded-lg font-bold hover:bg-blue-50 transition-all"><i class="fas fa-link mr-2"></i>Link Cliente</button>
                </div>
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden mb-6 shadow-sm">
                    <div class="bg-slate-50 px-6 py-3 border-b border-slate-200 font-bold text-xs uppercase text-slate-500">Dados do Cliente</div>
                    <div class="p-6 grid gap-4">
                        <input id="c-name" class="w-full border p-3 rounded-lg bg-slate-50" placeholder="Nome do Cliente" onchange="upVal('c-name',this.value)">
                        <div class="grid grid-cols-2 gap-4"><input id="c-doc" class="border p-3 rounded-lg bg-slate-50" placeholder="CPF/CNPJ" onchange="upVal('c-doc',this.value)"><input id="c-phone" class="border p-3 rounded-lg bg-slate-50" placeholder="Telefone" onchange="upVal('c-phone',this.value)"></div>
                        <input id="c-email" class="w-full border p-3 rounded-lg bg-slate-50" placeholder="E-mail" onchange="upVal('c-email',this.value)">
                        <input id="c-addr" class="w-full border p-3 rounded-lg bg-slate-50" placeholder="Endereço" onchange="upVal('c-addr',this.value)">
                        <label class="block mt-2 text-xs font-bold text-blue-600">Seu WhatsApp (Notificações)</label>
                        <input id="s-phone" class="w-full border border-blue-100 bg-blue-50 p-3 rounded-lg" placeholder="5511999999999" onchange="upVal('s-phone',this.value)">
                    </div>
                </div>
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-slate-50 px-6 py-3 border-b border-slate-200 font-bold text-xs uppercase text-slate-500 flex justify-between items-center"><span>Escopo</span><button id="btn-add" onclick="addItem()" class="text-blue-600 hover:underline font-bold">+ Adicionar Item</button></div>
                    <div id="ed-items" class="p-6 space-y-4"></div>
                </div>
            </div>
            <div class="overflow-y-auto">
                <div class="bg-white border border-slate-200 rounded-xl overflow-hidden shadow-lg sticky top-0">
                    <div class="bg-slate-900 px-6 py-4 border-b border-slate-800 font-bold text-xs uppercase text-slate-400">Resumo Financeiro</div>
                    <div class="p-6">
                        <div class="text-center mb-6"><div class="text-xs text-slate-400 uppercase tracking-widest mb-1">Total Global</div><div id="ed-total" class="text-4xl font-bold font-heading text-slate-900">R$ 0,00</div></div>
                        <div class="grid grid-cols-2 gap-4 mb-4"><input id="t-dead" class="border p-3 rounded-lg text-sm bg-slate-50" placeholder="Prazo" onchange="upVal('t-dead',this.value)"><input id="t-val" class="border p-3 rounded-lg text-sm bg-slate-50" placeholder="Validade" onchange="upVal('t-val',this.value)"></div>
                        <textarea id="t-obs" class="w-full border p-3 rounded-lg text-sm h-24 mb-4 bg-slate-50" placeholder="Observações..." onchange="upVal('t-obs',this.value)"></textarea>
                        <div id="ed-actions"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="view-public" class="hidden min-h-screen bg-gray-200 p-8 flex justify-center overflow-y-auto print:p-0">
        <div class="bg-white shadow-2xl w-full max-w-4xl min-h-[297mm] p-12 flex flex-col print:shadow-none">
            <div class="flex justify-between border-b-2 border-black pb-8 mb-8">
                <div><h1 class="text-4xl font-bold heading-font" id="pub-title">Projeto</h1><p class="text-gray-500 uppercase tracking-widest text-sm font-bold">Proposta Comercial</p></div>
                <div class="text-right"><div class="font-bold text-xl text-blue-600" id="pub-id">#REF</div><div class="text-sm text-gray-500" id="pub-date">--/--</div></div>
            </div>
            <div class="flex gap-8 mb-12">
                <div class="w-1/2"><h3 class="font-bold text-xs uppercase text-gray-400 mb-2 border-b pb-1">Cliente</h3><div class="font-bold text-lg" id="pub-client"></div><div class="text-gray-500" id="pub-doc"></div></div>
                <div class="w-1/2 text-right"><h3 class="font-bold text-xs uppercase text-gray-400 mb-2 border-b pb-1">Investimento</h3><div class="font-bold text-3xl font-heading text-slate-900" id="pub-total">R$ 0,00</div></div>
            </div>
            <div class="mb-8"><h3 class="font-bold text-xs uppercase text-gray-400 mb-4 border-b pb-1">Escopo</h3><div id="pub-items"></div></div>
            <div id="pub-actions" class="mt-auto pt-8 border-t no-print">
                <button onclick="approve()" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-700 transition-transform hover:scale-[1.01]">APROVAR PROPOSTA</button>
            </div>
            <div class="text-center text-[10px] text-gray-300 mt-4 no-print">Powered by Aprovado.app</div>
        </div>
    </section>

</body>
</html>
